{"version":3,"file":"webpack-wrapper.js","sourceRoot":"","sources":["../../src/webpack-wrapper.ts"],"names":[],"mappings":"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","sourcesContent":["import * as webpack from 'webpack';\nimport * as Path from 'path';\nimport { UserError } from '@angular/tsc-wrapped';\n\nimport { NgcWebpackPlugin } from './plugin';\n\n\n/**\n * Resolve the config to an object.\n * If it's a fn, invoke.\n *\n * Also check if it's a mocked ES6 Module in cases where TS file is used that uses \"export default\"\n * @param config\n * @returns {any}\n */\nfunction resolveConfig(config: any): any {\n  if (typeof config === 'function') {\n    return config();\n  } else if (config.__esModule === true && !!config.default) {\n    return resolveConfig(config.default);\n  } else {\n    return config;\n  }\n}\n\n\nexport class WebpackWrapper {\n  public plugin: NgcWebpackPlugin;\n  public aotResources: any = {}; //TODO: use Map if in node 5\n\n  private hasPlugin: boolean;\n\n\n  private constructor(public compiler: any) {\n    this.plugin = this.compiler.options.plugins\n      .filter( p => p instanceof NgcWebpackPlugin)[0];\n\n    this.hasPlugin = !!this.plugin;\n  };\n\n  emitOnCompilationSuccess(): void {\n    if (this.hasPlugin && typeof this.plugin.options.onCompilationSuccess === 'function') {\n      this.plugin.options.onCompilationSuccess.call(this);\n    }\n  }\n\n  emitOnCompilationError(err: Error): void {\n    if (this.hasPlugin && typeof this.plugin.options.onCompilationError === 'function') {\n      this.plugin.options.onCompilationError.call(this, err);\n    }\n  }\n\n  pathTransformer(path: string): string {\n    this.aotResources[path] = true;\n\n    if (this.plugin && typeof this.plugin.options.pathTransformer === 'function') {\n      return this.plugin.options.pathTransformer(path);\n    } else {\n      return path;\n    }\n  }\n\n  static fromConfig(webpackConfig: string | any): WebpackWrapper {\n    try {\n      let config: any;\n\n      if (!webpackConfig) {\n        webpackConfig = './webpack.config.js';\n      }\n\n      if (typeof webpackConfig === 'string') {\n        let configPath = Path.isAbsolute(webpackConfig)\n            ? webpackConfig\n            : Path.join(process.cwd(), webpackConfig)\n          ;\n\n        config = require(configPath);\n      } else {\n        config = webpackConfig;\n      }\n\n      const configModule = resolveConfig(config);\n      return WebpackWrapper.fromCompiler(webpack(configModule));\n    } catch (err) {\n      throw new UserError(`Invalid webpack configuration. Please set a valid --webpack argument.\\n${err.message}`);\n    }\n  }\n\n  static fromCompiler(compiler: any): WebpackWrapper {\n    return new WebpackWrapper(compiler);\n  }\n}"]}